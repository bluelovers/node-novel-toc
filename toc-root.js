"use strict";
/**
 * Created by user on 2018/11/14/014.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const array_hyper_unique_1 = require("array-hyper-unique");
const crlf_normalize_1 = require("crlf-normalize");
const FastGlob = require("fast-glob");
const path = require("upath2");
const BluebirdPromise = require("bluebird");
const fs = require("fs-extra");
const options_1 = require("node-novel-globby/lib/options");
const util_1 = require("./lib/util");
const toc_contents_1 = require("./toc_contents");
const sortObject = require("sort-object-keys2");
function searchByRoot(rootPath) {
    return BluebirdPromise.resolve(FastGlob.async([
        '!README.md',
        '!*/README.md',
        '!.*',
        '!docs',
        '*/*/**/README.md',
        '!*.new.*',
        '!*.out.*',
        '!*.raw',
        '!*.raw.*',
        '!.*',
        '!node_modules',
        '!out',
        '!raw',
    ], {
        cwd: rootPath,
        deep: 2,
    }))
        //.tap(v => console.info(v))
        .then(function (ls) {
        return filterList(ls.sort(), rootPath);
    })
        .tap(function (ls) {
        if (!ls.length) {
            console.warn(rootPath);
            return BluebirdPromise.reject(`list is empty`);
        }
    });
}
exports.searchByRoot = searchByRoot;
function isNovelID(dir, rootPath) {
    // @ts-ignore
    let _path = path.resolve(...[rootPath, path.dirname(dir)].filter(v => typeof v !== 'undefined'));
    return util_1.globFirst([
        '**/*.txt',
    ], {
        cwd: _path,
        absolute: true,
        ignore: options_1.defaultPatternsExclude,
    });
    //.tap(v => console.log(v))
}
exports.isNovelID = isNovelID;
function filterList(ls, rootPath) {
    return BluebirdPromise.reduce(ls, async function (arr, dir) {
        let dl = dir.split('/');
        if (dl.length > 3) {
            return arr;
        }
        if (!/_out$/.test(dl[0])) {
            let out = [dl[0] + '_out', ...dl.slice(1)];
            if (ls.includes(out.join('/'))) {
                return arr;
            }
        }
        let hasTxt = await isNovelID(dir, rootPath);
        if (hasTxt) {
            arr.push(dir);
        }
        return arr;
    }, [])
        .tap(function (ls) {
        if (!ls.length) {
            return BluebirdPromise.reject(`list is empty`);
        }
    });
}
exports.filterList = filterList;
function processDataByAuthor(ls, rootPath, options) {
    return BluebirdPromise.reduce(ls, async function (data, file) {
        let dl = file.split('/');
        let meta = await util_1.loadReadmeMeta(path.join(rootPath, file));
        let author = 'unknow';
        if (meta) {
            if (meta.novel) {
                if (meta.novel.author) {
                    author = meta.novel.author;
                }
                else if (meta.novel.authors && meta.novel.authors.length) {
                    author = meta.novel.authors[0];
                }
            }
        }
        else {
            return data;
        }
        data[author] = data[author] || {};
        let novelID = dl[1];
        data[author][novelID] = data[author][novelID] || [];
        data[author][novelID].push({
            novelID: dl[1],
            pathMain: dl[0],
            file,
            author,
            // @ts-ignore
            meta,
        });
        return data;
    }, {})
        .then(data => {
        sortObject(data, {
            sort: util_1.tocSortCallback,
            useSource: true,
        });
        Object.keys(data).forEach(function (author) {
            sortObject(data[author], {
                sort: util_1.tocSortCallback,
                useSource: true,
            });
        });
        let key = 'unknow';
        let old = data[key];
        delete data[key];
        if (old) {
            data[key] = old;
        }
        return data;
    });
}
exports.processDataByAuthor = processDataByAuthor;
function stringifyDataAuthor(data, rootPath, options) {
    let arr = [
        `# TOC\n`,
        `## Author\n`
    ];
    let arr_author = [];
    let authors = [];
    options = options || {};
    Object.entries(data)
        .forEach(function ([author, row], author_idx) {
        arr_author.push(`### ${author}\n`);
        authors.push(author);
        Object.entries(row)
            .forEach(function ([novelID, list]) {
            arr_author.push(`#### ${novelID}\n`);
            let skip = [
                novelID,
            ];
            let titles = [];
            let arr_item = [];
            list.forEach(function (item, index) {
                let link = path.dirname(item.file);
                let link2 = path.join(link, '導航目錄.md');
                if (fs.existsSync(path.join(rootPath, link2))) {
                    link = link2;
                }
                skip.push(novelID);
                let md = toc_contents_1.makeLink(`${novelID}`, link);
                let text = `- ${md} - *${item.pathMain}*`;
                if (options.cbForEachSubNovel) {
                    let ret = options.cbForEachSubNovel(text, item);
                    if (typeof ret === 'string') {
                        text = ret;
                    }
                }
                arr_item.push(text);
                titles = titles.concat(util_1.getNovelTitles(item.meta));
            });
            titles = array_hyper_unique_1.array_unique(titles)
                .filter(v => !skip.includes(v));
            if (titles.length) {
                arr_author.push(`> ${titles.join(' , ')}\n`);
            }
            arr_author = arr_author.concat(arr_item);
            arr_author.push(crlf_normalize_1.LF);
        });
    });
    let authors_anchor = authors.map(name => {
        return `[${util_1.md_link_escape(name)}](#${util_1.md_anchor_gitee(name)})`;
    }).join('  ／  ') + '\n';
    arr.push(authors_anchor);
    arr = arr.concat(arr_author);
    arr.push(crlf_normalize_1.LF);
    return arr.join(crlf_normalize_1.LF);
}
exports.stringifyDataAuthor = stringifyDataAuthor;
function createTocRoot(_root, outputFile, options) {
    options = options || {};
    return searchByRoot(_root)
        .then(function (ls) {
        return processDataByAuthor(ls, _root, options);
    })
        .then(function (data) {
        return stringifyDataAuthor(data, _root, options);
    })
        .tap(function (v) {
        if (outputFile) {
            return fs.outputFile(outputFile, v);
        }
    });
}
exports.createTocRoot = createTocRoot;
exports.default = createTocRoot;
//createTocRoot('D:/Users/Documents/The Project/nodejs-test/node-novel2/dist_novel').tap(v => console.dir(v))
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9jLXJvb3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0b2Mtcm9vdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsMkRBQWtEO0FBQ2xELG1EQUFvQztBQUNwQyxzQ0FBc0M7QUFDdEMsK0JBQWdDO0FBQ2hDLDRDQUE2QztBQUM3QywrQkFBK0I7QUFFL0IsMkRBQXVFO0FBRXZFLHFDQVFvQjtBQUNwQixpREFBMEM7QUFDMUMsZ0RBQWlEO0FBR2pELFNBQWdCLFlBQVksQ0FBQyxRQUFnQjtJQUU1QyxPQUFPLGVBQWUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBUztRQUNwRCxZQUFZO1FBQ1osY0FBYztRQUNkLEtBQUs7UUFDTCxPQUFPO1FBQ1Asa0JBQWtCO1FBRWxCLFVBQVU7UUFDVixVQUFVO1FBQ1YsUUFBUTtRQUNSLFVBQVU7UUFDVixLQUFLO1FBQ0wsZUFBZTtRQUNmLE1BQU07UUFDTixNQUFNO0tBRU4sRUFBRTtRQUNGLEdBQUcsRUFBRSxRQUFRO1FBQ2IsSUFBSSxFQUFFLENBQUM7S0FDUCxDQUFDLENBQUM7UUFDSCw0QkFBNEI7U0FDM0IsSUFBSSxDQUFDLFVBQVUsRUFBRTtRQUVqQixPQUFPLFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDdkMsQ0FBQyxDQUFDO1NBQ0QsR0FBRyxDQUFDLFVBQVUsRUFBRTtRQUVoQixJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFDZDtZQUNDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFdkIsT0FBTyxlQUFlLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFBO1NBQzlDO0lBQ0YsQ0FBQyxDQUFDLENBQ0Q7QUFDSCxDQUFDO0FBckNELG9DQXFDQztBQUVELFNBQWdCLFNBQVMsQ0FBQyxHQUFXLEVBQUUsUUFBaUI7SUFFdkQsYUFBYTtJQUNiLElBQUksS0FBSyxHQUFXLElB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Ii8qKlxuICogQ3JlYXRlZCBieSB1c2VyIG9uIDIwMTgvMTEvMTQvMDE0LlxuICovXG5cbmltcG9ydCB7IGFycmF5X3VuaXF1ZSB9IGZyb20gJ2FycmF5LWh5cGVyLXVuaXF1ZSc7XG5pbXBvcnQgeyBMRiB9IGZyb20gJ2NybGYtbm9ybWFsaXplJztcbmltcG9ydCAqIGFzIEZhc3RHbG9iIGZyb20gJ2Zhc3QtZ2xvYic7XG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoJ3VwYXRoMicpO1xuaW1wb3J0IEJsdWViaXJkUHJvbWlzZSA9IHJlcXVpcmUoJ2JsdWViaXJkJyk7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgKiBhcyBub3ZlbEdsb2JieSBmcm9tICdub2RlLW5vdmVsLWdsb2JieS9nJztcbmltcG9ydCB7IGRlZmF1bHRQYXR0ZXJuc0V4Y2x1ZGUgfSBmcm9tICdub2RlLW5vdmVsLWdsb2JieS9saWIvb3B0aW9ucyc7XG5pbXBvcnQgeyBJTWRjb25mTWV0YSB9IGZyb20gJ25vZGUtbm92ZWwtaW5mbyc7XG5pbXBvcnQge1xuXHRnbG9iRmlyc3QsXG5cdGxvYWRSZWFkbWVNZXRhLFxuXHRnZXROb3ZlbFRpdGxlcyxcblx0bWRfYW5jaG9yX2dpdGVlLFxuXHRtZF9ocmVmLFxuXHRtZF9saW5rX2VzY2FwZSxcblx0dG9jU29ydENhbGxiYWNrLFxufSBmcm9tICcuL2xpYi91dGlsJztcbmltcG9ydCB7IG1ha2VMaW5rIH0gZnJvbSAnLi90b2NfY29udGVudHMnO1xuaW1wb3J0IHNvcnRPYmplY3QgPSByZXF1aXJlKCdzb3J0LW9iamVjdC1rZXlzMicpO1xuaW1wb3J0IHsgZGVmYXVsdFNvcnRDYWxsYmFjaywgY3JlYXRlU29ydENhbGxiYWNrIH0gZnJvbSAnQG5vZGUtbm92ZWwvc29ydCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBzZWFyY2hCeVJvb3Qocm9vdFBhdGg6IHN0cmluZylcbntcblx0cmV0dXJuIEJsdWViaXJkUHJvbWlzZS5yZXNvbHZlKEZhc3RHbG9iLmFzeW5jPHN0cmluZz4oW1xuXHRcdFx0JyFSRUFETUUubWQnLFxuXHRcdFx0JyEqL1JFQURNRS5tZCcsXG5cdFx0XHQnIS4qJyxcblx0XHRcdCchZG9jcycsXG5cdFx0XHQnKi8qLyoqL1JFQURNRS5tZCcsXG5cblx0XHRcdCchKi5uZXcuKicsXG5cdFx0XHQnISoub3V0LionLFxuXHRcdFx0JyEqLnJhdycsXG5cdFx0XHQnISoucmF3LionLFxuXHRcdFx0JyEuKicsXG5cdFx0XHQnIW5vZGVfbW9kdWxlcycsXG5cdFx0XHQnIW91dCcsXG5cdFx0XHQnIXJhdycsXG5cblx0XHRdLCB7XG5cdFx0XHRjd2Q6IHJvb3RQYXRoLFxuXHRcdFx0ZGVlcDogMixcblx0XHR9KSlcblx0XHQvLy50YXAodiA9PiBjb25zb2xlLmluZm8odikpXG5cdFx0LnRoZW4oZnVuY3Rpb24gKGxzKVxuXHRcdHtcblx0XHRcdHJldHVybiBmaWx0ZXJMaXN0KGxzLnNvcnQoKSwgcm9vdFBhdGgpXG5cdFx0fSlcblx0XHQudGFwKGZ1bmN0aW9uIChscylcblx0XHR7XG5cdFx0XHRpZiAoIWxzLmxlbmd0aClcblx0XHRcdHtcblx0XHRcdFx0Y29uc29sZS53YXJuKHJvb3RQYXRoKTtcblxuXHRcdFx0XHRyZXR1cm4gQmx1ZWJpcmRQcm9taXNlLnJlamVjdChgbGlzdCBpcyBlbXB0eWApXG5cdFx0XHR9XG5cdFx0fSlcblx0XHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc05vdmVsSUQoZGlyOiBzdHJpbmcsIHJvb3RQYXRoPzogc3RyaW5nKVxue1xuXHQvLyBAdHMtaWdub3JlXG5cdGxldCBfcGF0aDogc3RyaW5nID0gcGF0aC5yZXNvbHZlKC4uLltyb290UGF0aCwgcGF0aC5kaXJuYW1lKGRpcildLmZpbHRlcih2ID0+IHR5cGVvZiB2ICE9PSAndW5kZWZpbmVkJykpO1xuXG5cdHJldHVybiBnbG9iRmlyc3QoW1xuXHRcdCcqKi8qLnR4dCcsXG5cdFx0Ly8uLi5kZWZhdWx0UGF0dGVybnNFeGNsdWRlLFxuXHRdLCB7XG5cdFx0Y3dkOiBfcGF0aCxcblx0XHRhYnNvbHV0ZTogdHJ1ZSxcblx0XHRpZ25vcmU6IGRlZmF1bHRQYXR0ZXJuc0V4Y2x1ZGUsXG5cdH0pXG5cdC8vLnRhcCh2ID0+IGNvbnNvbGUubG9nKHYpKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyTGlzdChsczogc3RyaW5nW10sIHJvb3RQYXRoPzogc3RyaW5nKVxue1xuXHRyZXR1cm4gQmx1ZWJpcmRQcm9taXNlLnJlZHVjZShscywgYXN5bmMgZnVuY3Rpb24gKGFyciwgZGlyKVxuXHRcdHtcblx0XHRcdGxldCBkbCA9IGRpci5zcGxpdCgnLycpO1xuXG5cdFx0XHRpZiAoZGwubGVuZ3RoID4gMylcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuIGFycjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCEvX291dCQvLnRlc3QoZGxbMF0pKVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgb3V0ID0gW2RsWzBdICsgJ19vdXQnLCAuLi5kbC5zbGljZSgxKV07XG5cblx0XHRcdFx0aWYgKGxzLmluY2x1ZGVzKG91dC5qb2luKCcvJykpKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0cmV0dXJuIGFycjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRsZXQgaGFzVHh0ID0gYXdhaXQgaXNOb3ZlbElEKGRpciwgcm9vdFBhdGgpO1xuXG5cdFx0XHRpZiAoaGFzVHh0KVxuXHRcdFx0e1xuXHRcdFx0XHRhcnIucHVzaChkaXIpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gYXJyO1xuXHRcdH0sIFtdIGFzIHN0cmluZ1tdKVxuXHRcdC50YXAoZnVuY3Rpb24gKGxzKVxuXHRcdHtcblx0XHRcdGlmICghbHMubGVuZ3RoKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm4gQmx1ZWJpcmRQcm9taXNlLnJlamVjdChgbGlzdCBpcyBlbXB0eWApXG5cdFx0XHR9XG5cdFx0fSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb2Nlc3NEYXRhQnlBdXRob3I8VCBleHRlbmRzIElNZGNvbmZNZXRhID0gSU1kY29uZk1ldGE+KGxzOiBzdHJpbmdbXSwgcm9vdFBhdGg6IHN0cmluZywgb3B0aW9ucz86IElPcHRpb25zPFQ+KVxue1xuXHRyZXR1cm4gQmx1ZWJpcmRQcm9taXNlLnJlZHVjZShscywgYXN5bmMgZnVuY3Rpb24gKGRhdGEsIGZpbGUpXG5cdFx0e1xuXHRcdFx0bGV0IGRsID0gZmlsZS5zcGxpdCgnLycpO1xuXG5cdFx0XHRsZXQgbWV0YSA9IGF3YWl0IGxvYWRSZWFkbWVNZXRhKHBhdGguam9pbihyb290UGF0aCwgZmlsZSkpO1xuXG5cdFx0XHRsZXQgYXV0aG9yID0gJ3Vua25vdyc7XG5cblx0XHRcdGlmIChtZXRhKVxuXHRcdFx0e1xuXHRcdFx0XHRpZiAobWV0YS5ub3ZlbClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGlmIChtZXRhLm5vdmVsLmF1dGhvcilcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRhdXRob3IgPSBtZXRhLm5vdmVsLmF1dGhvclxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRlbHNlIGlmIChtZXRhLm5vdmVsLmF1dGhvcnMgJiYgbWV0YS5ub3ZlbC5hdXRob3JzLmxlbmd0aClcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRhdXRob3IgPSBtZXRhLm5vdmVsLmF1dGhvcnNbMF1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuIGRhdGE7XG5cdFx0XHR9XG5cblx0XHRcdGRhdGFbYXV0aG9yXSA9IGRhdGFbYXV0aG9yXSB8fCB7fTtcblxuXHRcdFx0bGV0IG5vdmVsSUQgPSBkbFsxXTtcblxuXHRcdFx0ZGF0YVthdXRob3JdW25vdmVsSURdID0gZGF0YVthdXRob3JdW25vdmVsSURdIHx8IFtdO1xuXG5cdFx0XHRkYXRhW2F1dGhvcl1bbm92ZWxJRF0ucHVzaCh7XG5cdFx0XHRcdG5vdmVsSUQ6IGRsWzFdLFxuXHRcdFx0XHRwYXRoTWFpbjogZGxbMF0sXG5cdFx0XHRcdGZpbGUsXG5cdFx0XHRcdGF1dGhvcixcblx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0XHRtZXRhLFxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBkYXRhO1xuXHRcdH0sIHt9IGFzIElEYXRhQXV0aG9yPFQ+KVxuXHRcdC50aGVuKGRhdGEgPT5cblx0XHR7XG5cblx0XHRcdHNvcnRPYmplY3QoZGF0YSwge1xuXHRcdFx0XHRzb3J0OiB0b2NTb3J0Q2FsbGJhY2ssXG5cdFx0XHRcdHVzZVNvdXJjZTogdHJ1ZSxcblx0XHRcdH0pO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhkYXRhKS5mb3JFYWNoKGZ1bmN0aW9uIChhdXRob3IpXG5cdFx0XHR7XG5cdFx0XHRcdHNvcnRPYmplY3QoZGF0YVthdXRob3JdLCB7XG5cdFx0XHRcdFx0c29ydDogdG9jU29ydENhbGxiYWNrLFxuXHRcdFx0XHRcdHVzZVNvdXJjZTogdHJ1ZSxcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGtleSA9ICd1bmtub3cnO1xuXHRcdFx0bGV0IG9sZCA9IGRhdGFba2V5XTtcblxuXHRcdFx0ZGVsZXRlIGRhdGFba2V5XTtcblxuXHRcdFx0aWYgKG9sZClcblx0XHRcdHtcblx0XHRcdFx0ZGF0YVtrZXldID0gb2xkO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZGF0YTtcblx0XHR9KVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElEYXRhQXV0aG9yPFQgZXh0ZW5kcyBJTWRjb25mTWV0YSA9IElNZGNvbmZNZXRhPlxue1xuXHRbYXV0aG9yOiBzdHJpbmddOiBJRGF0YUF1dGhvck5vdmVsPFQ+LFxuXHR1bmtub3c/OiBJRGF0YUF1dGhvck5vdmVsPFQ+LFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElEYXRhQXV0aG9yTm92ZWw8VCBleHRlbmRzIElNZGNvbmZNZXRhID0gSU1kY29uZk1ldGE+XG57XG5cdFtub3ZlbElEOiBzdHJpbmddOiBJRGF0YUF1dGhvck5vdmVsSXRlbTxUPltdXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSURhdGFBdXRob3JOb3ZlbEl0ZW08VCBleHRlbmRzIElNZGNvbmZNZXRhID0gSU1kY29uZk1ldGE+XG57XG5cdG5vdmVsSUQ6IHN0cmluZyxcblx0cGF0aE1haW46IHN0cmluZyxcblx0ZmlsZTogc3RyaW5nLFxuXHRhdXRob3I6IHN0cmluZyB8ICd1bmtub3cnLFxuXHRtZXRhOiBULFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElPcHRpb25zPFQgZXh0ZW5kcyBJTWRjb25mTWV0YT5cbntcblx0Y2JGb3JFYWNoU3ViTm92ZWw/KHRleHQ6IHN0cmluZywgaXRlbTogSURhdGFBdXRob3JOb3ZlbEl0ZW08VD4pOiB2b2lkIHwgc3RyaW5nLFxufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RyaW5naWZ5RGF0YUF1dGhvcjxUIGV4dGVuZHMgSU1kY29uZk1ldGEgPSBJTWRjb25mTWV0YT4oZGF0YTogSURhdGFBdXRob3I8VD4sIHJvb3RQYXRoOiBzdHJpbmcsIG9wdGlvbnM/OiBJT3B0aW9uczxUPilcbntcblx0bGV0IGFyciA9IFtcblx0XHRgIyBUT0NcXG5gLFxuXHRcdGAjIyBBdXRob3JcXG5gXG5cdF07XG5cblx0bGV0IGFycl9hdXRob3I6IHN0cmluZ1tdID0gW107XG5cblx0bGV0IGF1dGhvcnM6IHN0cmluZ1tdID0gW107XG5cblx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cblx0T2JqZWN0LmVudHJpZXMoZGF0YSlcblx0XHQuZm9yRWFjaChmdW5jdGlvbiAoW2F1dGhvciwgcm93XSwgYXV0aG9yX2lkeClcblx0XHR7XG5cdFx0XHRhcnJfYXV0aG9yLnB1c2goYCMjIyAke2F1dGhvcn1cXG5gKTtcblxuXHRcdFx0YXV0aG9ycy5wdXNoKGF1dGhvcik7XG5cblx0XHRcdE9iamVjdC5lbnRyaWVzKHJvdylcblx0XHRcdFx0LmZvckVhY2goZnVuY3Rpb24gKFtub3ZlbElELCBsaXN0XSlcblx0XHRcdFx0e1xuXG5cdFx0XHRcdFx0YXJyX2F1dGhvci5wdXNoKGAjIyMjICR7bm92ZWxJRH1cXG5gKTtcblxuXHRcdFx0XHRcdGxldCBza2lwID0gW1xuXHRcdFx0XHRcdFx0bm92ZWxJRCxcblx0XHRcdFx0XHRdO1xuXG5cdFx0XHRcdFx0bGV0IHRpdGxlcyA9IFtdO1xuXG5cdFx0XHRcdFx0bGV0IGFycl9pdGVtID0gW107XG5cblx0XHRcdFx0XHRsaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdGxldCBsaW5rID0gcGF0aC5kaXJuYW1lKGl0ZW0uZmlsZSk7XG5cblx0XHRcdFx0XHRcdGxldCBsaW5rMiA9IHBhdGguam9pbihsaW5rLCAn5bCO6Iiq55uu6YyELm1kJyk7XG5cblx0XHRcdFx0XHRcdGlmIChmcy5leGlzdHNTeW5jKHBhdGguam9pbihyb290UGF0aCwgbGluazIpKSlcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0bGluayA9IGxpbmsyXG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHNraXAucHVzaChub3ZlbElEKTtcblxuXHRcdFx0XHRcdFx0bGV0IG1kID0gbWFrZUxpbmsoYCR7bm92ZWxJRH1gLCBsaW5rKTtcblxuXHRcdFx0XHRcdFx0bGV0IHRleHQgPSBgLSAke21kfSAtICoke2l0ZW0ucGF0aE1haW59KmA7XG5cblx0XHRcdFx0XHRcdGlmIChvcHRpb25zLmNiRm9yRWFjaFN1Yk5vdmVsKVxuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gb3B0aW9ucy5jYkZvckVhY2hTdWJOb3ZlbCh0ZXh0LCBpdGVtKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIHJldCA9PT0gJ3N0cmluZycpXG5cdFx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0XHR0ZXh0ID0gcmV0O1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGFycl9pdGVtLnB1c2godGV4dCk7XG5cblx0XHRcdFx0XHRcdHRpdGxlcyA9IHRpdGxlcy5jb25jYXQoZ2V0Tm92ZWxUaXRsZXMoaXRlbS5tZXRhKSlcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHRpdGxlcyA9IGFycmF5X3VuaXF1ZSh0aXRsZXMpXG5cdFx0XHRcdFx0XHQuZmlsdGVyKHYgPT4gIXNraXAuaW5jbHVkZXModikpXG5cdFx0XHRcdFx0O1xuXG5cdFx0XHRcdFx0aWYgKHRpdGxlcy5sZW5ndGgpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0YXJyX2F1dGhvci5wdXNoKGA+ICR7dGl0bGVzLmpvaW4oJyAsICcpfVxcbmApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGFycl9hdXRob3IgPSBhcnJfYXV0aG9yLmNvbmNhdChhcnJfaXRlbSk7XG5cblx0XHRcdFx0XHRhcnJfYXV0aG9yLnB1c2goTEYpO1xuXHRcdFx0XHR9KVxuXHRcdFx0O1xuXHRcdH0pXG5cdDtcblxuXHRsZXQgYXV0aG9yc19hbmNob3IgPSBhdXRob3JzLm1hcChuYW1lID0+IHtcblx0XHRyZXR1cm4gYFske21kX2xpbmtfZXNjYXBlKG5hbWUpfV0oIyR7bWRfYW5jaG9yX2dpdGVlKG5hbWUpfSlgO1xuXHR9KS5qb2luKCcgIO+8jyAgJykgKyAnXFxuJztcblxuXHRhcnIucHVzaChhdXRob3JzX2FuY2hvcik7XG5cblx0YXJyID0gYXJyLmNvbmNhdChhcnJfYXV0aG9yKTtcblxuXHRhcnIucHVzaChMRik7XG5cblx0cmV0dXJuIGFyci5qb2luKExGKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVG9jUm9vdDxUIGV4dGVuZHMgSU1kY29uZk1ldGEgPSBJTWRjb25mTWV0YT4oX3Jvb3Q6IHN0cmluZywgb3V0cHV0RmlsZT86IHN0cmluZywgb3B0aW9ucz86IElPcHRpb25zPFQ+KVxue1xuXHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuXHRyZXR1cm4gc2VhcmNoQnlSb290KF9yb290KVxuXHRcdC50aGVuKGZ1bmN0aW9uIChscylcblx0XHR7XG5cdFx0XHRyZXR1cm4gcHJvY2Vzc0RhdGFCeUF1dGhvcjxUPihscywgX3Jvb3QsIG9wdGlvbnMpO1xuXHRcdH0pXG5cdFx0LnRoZW4oZnVuY3Rpb24gKGRhdGEpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIHN0cmluZ2lmeURhdGFBdXRob3I8VD4oZGF0YSwgX3Jvb3QsIG9wdGlvbnMpXG5cdFx0fSlcblx0XHQudGFwKGZ1bmN0aW9uICh2KVxuXHRcdHtcblx0XHRcdGlmIChvdXRwdXRGaWxlKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm4gZnMub3V0cHV0RmlsZShvdXRwdXRGaWxlLCB2KTtcblx0XHRcdH1cblx0XHR9KVxuXHRcdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlVG9jUm9vdFxuXG4vL2NyZWF0ZVRvY1Jvb3QoJ0Q6L1VzZXJzL0RvY3VtZW50cy9UaGUgUHJvamVjdC9ub2RlanMtdGVzdC9ub2RlLW5vdmVsMi9kaXN0X25vdmVsJykudGFwKHYgPT4gY29uc29sZS5kaXIodikpXG4iXX0=